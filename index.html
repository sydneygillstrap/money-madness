<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Money Madness: Maze Quest</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Retro Font -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        body {
            background-color: #202028;
            font-family: 'Press Start 2P', cursive;
            color: white;
            image-rendering: pixelated;
            overflow: hidden; /* Prevent scrolling on key press */
        }
        .pixel-border {
            box-shadow: -4px 0 0 0 white, 4px 0 0 0 white, 0 -4px 0 0 white, 0 4px 0 0 white;
            margin: 4px;
        }
        .pixel-btn {
            box-shadow: inset -4px -4px 0px 0px rgba(0,0,0,0.5);
            transition: transform 0.1s;
        }
        .pixel-btn:active {
            box-shadow: inset 4px 4px 0px 0px rgba(0,0,0,0.5);
            transform: translateY(2px);
        }
        .coin-scroll::-webkit-scrollbar { height: 8px; }
        .coin-scroll::-webkit-scrollbar-track { background: #333; }
        .coin-scroll::-webkit-scrollbar-thumb { background: #666; }
        
        .animate-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        /* Maze Styles */
        .maze-cell { width: 40px; height: 40px; }
        .player-token { transition: all 0.2s linear; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- Level Config ---
        const LEVELS = [
            { id: 1, name: "Whispering Woods", icon: "üå≤", bg: "bg-green-800", wall: "bg-green-950", path: "bg-green-700" },
            { id: 2, name: "Merchant Village", icon: "üè†", bg: "bg-amber-800", wall: "bg-amber-950", path: "bg-amber-700" },
            { id: 3, name: "Goblin Bridge", icon: "üåâ", bg: "bg-slate-700", wall: "bg-slate-900", path: "bg-slate-600" },
            { id: 4, name: "Crystal Cave", icon: "üíé", bg: "bg-purple-800", wall: "bg-purple-950", path: "bg-purple-700" },
            { id: 5, name: "Dragon's Keep", icon: "üêâ", bg: "bg-red-800", wall: "bg-red-950", path: "bg-red-700" }
        ];

        // --- Maze Layouts (10x10 Grid: 1=Wall, 0=Path, 2=Start) ---
        // Tasks will be placed randomly on 0 spots
        const MAZES = [
            // Level 1: Simple
            [
                [1,1,1,1,1,1,1,1,1,1],
                [1,2,0,0,0,1,0,0,0,1],
                [1,0,1,1,0,1,0,1,0,1],
                [1,0,0,0,0,0,0,1,0,1],
                [1,0,1,1,1,1,0,1,0,1],
                [1,0,0,0,0,0,0,0,0,1],
                [1,1,1,0,1,1,1,1,0,1],
                [1,0,0,0,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1]
            ],
            // Level 2
            [
                [1,1,1,1,1,1,1,1,1,1],
                [1,2,0,1,0,0,0,0,0,1],
                [1,1,0,1,0,1,1,1,0,1],
                [1,0,0,0,0,0,0,1,0,1],
                [1,0,1,1,1,1,0,0,0,1],
                [1,0,0,0,0,1,1,1,0,1],
                [1,1,1,1,0,0,0,1,0,1],
                [1,0,0,0,0,1,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1]
            ],
            // Level 3
            [
                [1,1,1,1,1,1,1,1,1,1],
                [1,2,0,0,0,0,0,1,0,1],
                [1,1,1,1,1,1,0,1,0,1],
                [1,0,0,0,0,0,0,0,0,1],
                [1,0,1,1,1,1,1,1,1,1],
                [1,0,0,0,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,0,1],
                [1,0,0,0,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1]
            ],
            // Level 4
            [
                [1,1,1,1,1,1,1,1,1,1],
                [1,2,0,1,0,0,0,1,0,1],
                [1,0,0,1,0,1,0,0,0,1],
                [1,0,1,1,0,1,1,1,1,1],
                [1,0,0,0,0,0,0,0,0,1],
                [1,1,1,1,0,1,1,1,0,1],
                [1,0,0,1,0,0,0,1,0,1],
                [1,0,0,0,0,1,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1]
            ],
            // Level 5
            [
                [1,1,1,1,1,1,1,1,1,1],
                [1,2,0,0,0,1,0,0,0,1],
                [1,1,1,1,0,1,0,1,0,1],
                [1,0,0,0,0,0,0,1,0,1],
                [1,0,1,1,1,0,1,1,0,1],
                [1,0,0,0,1,0,0,0,0,1],
                [1,1,1,0,1,1,1,1,1,1],
                [1,0,0,0,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1]
            ]
        ];

        // --- Game Data ---
        const questionsData = [
            // Level 1
            { id: 1, text: "Captain Redbeard dropped 2 quarters! How much money is that?", visualType: "coins", coins: ["quarter", "quarter"], options: ["25¬¢", "50¬¢", "$1.00"], correct: "50¬¢", hint: "25 + 25 = 50", enemy: "üè¥‚Äç‚ò†Ô∏è" },
            { id: 2, text: "You have 50¬¢. You buy a Magic Bean for 10¬¢. How much is left?", visualType: "subtraction", start: "50¬¢", minus: "10¬¢", options: ["60¬¢", "40¬¢", "30¬¢"], correct: "40¬¢", hint: "50 - 10", enemy: "üå±" },
            { id: 3, text: "The Robot needs fuel! Add these up: 2 Dimes and 1 Nickel.", visualType: "coins", coins: ["dime", "dime", "nickel"], options: ["25¬¢", "30¬¢", "15¬¢"], correct: "25¬¢", hint: "10 + 10 + 5", enemy: "ü§ñ" },
            // Level 2
            { id: 4, text: "You have $1.00. A Goblin steals 60¬¢! How much do you have left?", visualType: "simple", image: "üë∫", options: ["40¬¢", "50¬¢", "60¬¢"], correct: "40¬¢", hint: "100 - 60", enemy: "üë∫" },
            { id: 5, text: "The bridge toll is 20¬¢. Which coins pay the toll?", visualType: "text-only", options: ["2 Dimes", "2 Nickels", "1 Quarter"], correct: "2 Dimes", hint: "10 + 10", enemy: "üåâ" },
            { id: 6, text: "Shop Sale! You buy a Potion (30¬¢) and a Wand (20¬¢). Total cost?", visualType: "items", items: ["üß™ 30¬¢", "ü™Ñ 20¬¢"], options: ["10¬¢", "40¬¢", "50¬¢"], correct: "50¬¢", hint: "30 + 20", enemy: "üßô‚Äç‚ôÄÔ∏è" },
            // Level 3
            { id: 7, text: "You found loot! You found 3 pennies and 1 nickel. Count it up.", visualType: "coins", coins: ["penny", "penny", "penny", "nickel"], options: ["8¬¢", "4¬¢", "13¬¢"], correct: "8¬¢", hint: "1+1+1+5", enemy: "üí∞" },
            { id: 8, text: "True or False: 100 pennies is the same amount as $1.00.", visualType: "simple", image: "üí∞", options: ["True", "False"], correct: "True", hint: "Yes!", enemy: "‚öñÔ∏è" },
            { id: 9, text: "You have 75¬¢. You spend 25¬¢ on a map. What is left?", visualType: "subtraction", start: "75¬¢", minus: "25¬¢", options: ["100¬¢", "50¬¢", "25¬¢"], correct: "50¬¢", hint: "75 - 25", enemy: "üó∫Ô∏è" },
            // Level 4
            { id: 10, text: "Which is the correct way to write fifty cents?", visualType: "text-only", options: ["$0.50", "0.50¬¢", "$50"], correct: "$0.50", hint: "$ in front", enemy: "‚úçÔ∏è" },
            { id: 11, text: "Finish the pattern counting by 10s: 10, 20, 30... what is next?", visualType: "simple", image: "üöÄ", options: ["35", "40", "50"], correct: "40", hint: "+10", enemy: "üî¢" },
            { id: 12, text: "School Quest: A pencil is 15¬¢ and an eraser is 5¬¢. Total cost?", visualType: "items", items: ["‚úèÔ∏è 15¬¢", "üßº 5¬¢"], options: ["20¬¢", "10¬¢", "25¬¢"], correct: "20¬¢", hint: "15 + 5", enemy: "üéí" },
            // Level 5
            { id: 13, text: "How many quarters do you need to make exactly $1.00?", visualType: "coins", coins: ["quarter", "quarter", "quarter", "quarter"], options: ["2", "3", "4"], correct: "4", hint: "4 quarters", enemy: "ü™ô" },
            { id: 14, text: "You had 90¬¢, but you lost a dime. How much do you have now?", visualType: "subtraction", start: "90¬¢", minus: "10¬¢", options: ["80¬¢", "100¬¢", "85¬¢"], correct: "80¬¢", hint: "90 - 10", enemy: "üìâ" },
            { id: 15, text: "Boss Battle! Do 2 quarters and 5 dimes add up to exactly $1.00?", visualType: "coins", coins: ["quarter", "quarter", "dime", "dime", "dime", "dime", "dime"], options: ["Yes", "No"], correct: "Yes", hint: "50 + 50", enemy: "üê≤" }
        ];

        const Coin = ({ type, onClick, small }) => {
            const sizeClass = small ? (type === 'quarter' ? 'w-10 h-10' : 'w-8 h-8') : (type === 'quarter' ? 'w-16 h-16' : type === 'dime' ? 'w-10 h-10' : 'w-12 h-12');
            const styles = {
                penny: "bg-orange-700 border-orange-900 text-orange-100",
                nickel: "bg-gray-400 border-gray-600 text-white",
                dime: "bg-gray-300 border-gray-500 text-gray-800",
                quarter: "bg-gray-200 border-gray-500 text-gray-900"
            };
            const labels = { penny: "1¬¢", nickel: "5¬¢", dime: "10¬¢", quarter: "25¬¢" };
            return (
                <div onClick={onClick} className={`${styles[type]} ${sizeClass} rounded-full border-4 flex items-center justify-center font-bold m-1 transform hover:scale-110 active:scale-90 transition-all cursor-pointer select-none shadow-lg text-[10px] md:text-xs`}>
                    {labels[type]}
                </div>
            );
        };

        const CoinWorkspace = () => {
            const [workspaceCoins, setWorkspaceCoins] = useState([]);
            const addCoin = (type) => setWorkspaceCoins([...workspaceCoins, { type, id: Date.now() }]);
            const removeCoin = (id) => setWorkspaceCoins(workspaceCoins.filter(c => c.id !== id));
            const clearAll = () => setWorkspaceCoins([]);
            return (
                <div className="bg-gray-800 border-4 border-gray-500 p-4 w-full h-full rounded-lg shadow-xl">
                    <div className="flex justify-between items-center mb-2 border-b-2 border-gray-600 pb-2">
                        <h3 className="text-yellow-400 text-xs md:text-sm uppercase tracking-widest">üéí Inventory</h3>
                        <button onClick={clearAll} className="text-[10px] bg-red-600 text-white px-2 py-1 rounded hover:bg-red-500 pixel-btn">RESET</button>
                    </div>
                    <div className="flex justify-center gap-2 mb-4 bg-gray-900 p-2 rounded border-2 border-gray-700">
                        <Coin type="penny" small onClick={() => addCoin('penny')} />
                        <Coin type="nickel" small onClick={() => addCoin('nickel')} />
                        <Coin type="dime" small onClick={() => addCoin('dime')} />
                        <Coin type="quarter" small onClick={() => addCoin('quarter')} />
                    </div>
                    <div className="min-h-[200px] bg-gray-900 rounded border-2 border-dashed border-gray-700 p-2 flex flex-wrap content-start items-start coin-scroll">
                        {workspaceCoins.length === 0 && <span className="w-full text-center text-gray-600 text-[10px] mt-8">Items go here...</span>}
                        {workspaceCoins.map((c) => <Coin key={c.id} type={c.type} small onClick={() => removeCoin(c.id)} />)}
                    </div>
                </div>
            );
        };

        const MoneyMadness = () => {
            const [gameState, setGameState] = useState('start'); 
            const [character, setCharacter] = useState(null);
            
            // Level State
            const [currentLevelIdx, setCurrentLevelIdx] = useState(0);
            const [levelTasks, setLevelTasks] = useState([]);
            const [grid, setGrid] = useState([]);
            const [playerPos, setPlayerPos] = useState({ x: 1, y: 1 });
            const [activeTaskIndex, setActiveTaskIndex] = useState(null);
            
            // Global State
            const [gold, setGold] = useState(0);
            const [attempts, setAttempts] = useState(0); 
            const [disabledOptions, setDisabledOptions] = useState([]);
            const [shake, setShake] = useState(false);
            const [completedTasks, setCompletedTasks] = useState(0);

            const characters = [
                { id: 'knight', name: 'Knight', icon: 'üõ°Ô∏è', color: 'bg-blue-600' },
                { id: 'wizard', name: 'Wizard', icon: 'üßô‚Äç‚ôÇÔ∏è', color: 'bg-purple-600' },
                { id: 'rogue', name: 'Rogue', icon: 'üó°Ô∏è', color: 'bg-green-600' }
            ];

            const currentLevelData = LEVELS[currentLevelIdx] || LEVELS[0];

            // --- Movement Logic ---
            const handleMove = useCallback((dx, dy) => {
                if (gameState !== 'maze') return;
                
                const newX = playerPos.x + dx;
                const newY = playerPos.y + dy;

                // Bounds Check
                if (newY < 0 || newY >= grid.length || newX < 0 || newX >= grid[0].length) return;

                // Wall Check (1 is wall)
                if (grid[newY][newX] === 1) return;

                // Update Position
                setPlayerPos({ x: newX, y: newY });

                // Task Check
                const taskIndex = levelTasks.findIndex(t => t.x === newX && t.y === newY && t.status === 'open');
                if (taskIndex !== -1) {
                    setActiveTaskIndex(taskIndex);
                    setAttempts(0);
                    setDisabledOptions([]);
                    setGameState('playing');
                }
            }, [gameState, grid, playerPos, levelTasks]);

            // Keyboard Listeners
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.key === 'ArrowUp') handleMove(0, -1);
                    if (e.key === 'ArrowDown') handleMove(0, 1);
                    if (e.key === 'ArrowLeft') handleMove(-1, 0);
                    if (e.key === 'ArrowRight') handleMove(1, 0);
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [handleMove]);


            const startGame = (char) => {
                setCharacter(char);
                setCurrentLevelIdx(0);
                setGold(0);
                startLevel(0);
            };

            const startLevel = (lvlIdx) => {
                const startQ = lvlIdx * 3;
                const endQ = startQ + 3;
                
                // Get Base Maze
                // We clone the maze array so we don't modify the original constant
                const baseMaze = MAZES[lvlIdx] || MAZES[0];
                const newGrid = baseMaze.map(row => [...row]); 

                // Find valid start pos (marked as 2)
                let startX = 1, startY = 1;
                for(let y=0; y<newGrid.length; y++) {
                    for(let x=0; x<newGrid[0].length; x++) {
                        if(newGrid[y][x] === 2) {
                            startX = x;
                            startY = y;
                        }
                    }
                }
                
                // Place Tasks on empty spots (0)
                const tasksForLevel = questionsData.slice(startQ, endQ).map((q, i) => {
                    let placed = false;
                    let tx = 0, ty = 0;
                    while (!placed) {
                        const ry = Math.floor(Math.random() * newGrid.length);
                        const rx = Math.floor(Math.random() * newGrid[0].length);
                        // Ensure not start, not wall, and not too close to start if possible
                        if (newGrid[ry][rx] === 0 && (Math.abs(rx-startX) > 1 || Math.abs(ry-startY) > 1)) {
                            tx = rx; ty = ry;
                            placed = true;
                            // Mark grid so other tasks don't overlap
                            newGrid[ry][rx] = 9; // 9 = temp occupied
                        }
                    }
                    return { ...q, x: tx, y: ty, status: 'open' };
                });

                setGrid(baseMaze); // Use base maze for rendering walls
                setPlayerPos({ x: startX, y: startY });
                setLevelTasks(tasksForLevel);
                setCompletedTasks(0);
                setCurrentLevelIdx(lvlIdx);
                setGameState('levelIntro');
            };

            const enterMap = () => {
                setGameState('maze');
            };

            const handleAnswer = (option) => {
                const currentTask = levelTasks[activeTaskIndex];
                if (option === currentTask.correct) {
                    setGold(g => g + (attempts === 0 ? 100 : 50));
                    confetti({ particleCount: 50, spread: 60, origin: { y: 0.7 } });
                    
                    const newTasks = [...levelTasks];
                    newTasks[activeTaskIndex].status = 'solved';
                    setLevelTasks(newTasks);
                    setCompletedTasks(prev => prev + 1);

                    setTimeout(() => {
                        const allSolved = newTasks.every(t => t.status === 'solved');
                        if (allSolved) {
                             if (currentLevelIdx === 4) setGameState('end');
                             else setGameState('levelOutro');
                        } else {
                            setGameState('maze');
                        }
                    }, 1000);

                } else {
                    if (attempts === 0) {
                        setAttempts(1);
                        setDisabledOptions(prev => [...prev, option]);
                        setShake(true);
                        setTimeout(() => setShake(false), 500);
                    } else {
                        // Mark solved anyway to progress game flow, but no points
                        setShake(true);
                        setTimeout(() => setShake(false), 500);
                        const newTasks = [...levelTasks];
                        newTasks[activeTaskIndex].status = 'solved';
                        setLevelTasks(newTasks);
                        setCompletedTasks(prev => prev + 1);
                        
                        setTimeout(() => {
                            const allSolved = newTasks.every(t => t.status === 'solved');
                            if (allSolved) {
                                if (currentLevelIdx === 4) setGameState('end');
                                else setGameState('levelOutro');
                            } else {
                                setGameState('maze');
                            }
                        }, 1000);
                    }
                }
            };
            
            const advanceLevel = () => {
                 startLevel(currentLevelIdx + 1);
            };

            // --- RENDERERS ---

            if (gameState === 'start') {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen p-4 text-center">
                        <h1 className="text-4xl md:text-6xl text-yellow-400 mb-8 drop-shadow-md">MONEY MAZE</h1>
                        <p className="text-white mb-8 text-xs md:text-sm max-w-md">Select your hero to enter the maze!</p>
                        <div className="flex gap-4 flex-wrap justify-center">
                            {characters.map(c => (
                                <button key={c.id} onClick={() => startGame(c)} className={`flex flex-col items-center justify-center w-32 h-40 ${c.color} border-4 border-white pixel-btn hover:scale-105 transition-transform`}>
                                    <span className="text-4xl mb-2">{c.icon}</span>
                                    <span className="text-xs uppercase">{c.name}</span>
                                </button>
                            ))}
                        </div>
                    </div>
                );
            }

            if (gameState === 'levelIntro') {
                return (
                     <div className={`flex flex-col items-center justify-center min-h-screen p-4 text-center ${currentLevelData.bg} transition-colors duration-1000`}>
                        <h2 className="text-white text-lg mb-2">ENTERING LEVEL {currentLevelIdx + 1}</h2>
                        <h1 className="text-4xl md:text-6xl text-yellow-400 mb-6 drop-shadow-md">{currentLevelData.name}</h1>
                        <div className="text-8xl mb-8 animate-bounce">{currentLevelData.icon}</div>
                        <p className="text-white text-xs mb-8">Navigate the maze to find 3 tasks!</p>
                        <button onClick={enterMap} className="bg-white text-black border-4 border-gray-300 px-8 py-4 pixel-btn text-sm uppercase">
                            ENTER MAZE
                        </button>
                    </div>
                );
            }

            if (gameState === 'maze') {
                return (
                    <div className={`min-h-screen flex flex-col items-center py-2 px-2 ${currentLevelData.bg}`}>
                        {/* HUD */}
                        <div className="w-full max-w-md mb-2 flex justify-between items-center bg-gray-900 p-2 border-2 border-white rounded">
                            <div className="text-left">
                                <div className="text-[10px] text-gray-400">LEVEL {currentLevelIdx + 1}</div>
                                <div className="text-xs text-white">{currentLevelData.name}</div>
                            </div>
                            <div className="text-right">
                                <div className="text-[10px] text-yellow-400">TASKS</div>
                                <div className="flex gap-1">
                                    {[0,1,2].map(i => (
                                        <span key={i} className={`text-sm ${i < completedTasks ? 'text-green-400' : 'text-gray-600'}`}>
                                            {i < completedTasks ? '‚úÖ' : '‚≠ï'}
                                        </span>
                                    ))}
                                </div>
                            </div>
                        </div>
                        
                        {/* MAZE GRID */}
                        <div className="relative bg-black border-4 border-white p-1 rounded shadow-2xl">
                            {grid.map((row, rowIndex) => (
                                <div key={rowIndex} className="flex">
                                    {row.map((cell, colIndex) => {
                                        // Is this a wall?
                                        const isWall = cell === 1;
                                        // Is there a task here?
                                        const task = levelTasks.find(t => t.x === colIndex && t.y === rowIndex && t.status === 'open');
                                        // Is player here?
                                        const isPlayer = playerPos.x === colIndex && playerPos.y === rowIndex;
                                        
                                        return (
                                            <div 
                                                key={colIndex} 
                                                className={`maze-cell flex items-center justify-center ${isWall ? currentLevelData.wall : currentLevelData.path}`}
                                            >
                                                {task && <span className="text-2xl animate-pulse">{task.enemy}</span>}
                                                {isPlayer && <span className="text-2xl z-10">{character.icon}</span>}
                                            </div>
                                        );
                                    })}
                                </div>
                            ))}
                        </div>

                        {/* CONTROLS (D-PAD) */}
                        <div className="mt-4 grid grid-cols-3 gap-2">
                            <div></div>
                            <button onTouchStart={() => handleMove(0, -1)} onClick={() => handleMove(0, -1)} className="w-14 h-14 bg-gray-700 border-b-4 border-gray-900 rounded flex items-center justify-center text-2xl active:bg-gray-600">‚¨ÜÔ∏è</button>
                            <div></div>
                            <button onTouchStart={() => handleMove(-1, 0)} onClick={() => handleMove(-1, 0)} className="w-14 h-14 bg-gray-700 border-b-4 border-gray-900 rounded flex items-center justify-center text-2xl active:bg-gray-600">‚¨ÖÔ∏è</button>
                            <button onTouchStart={() => handleMove(0, 1)} onClick={() => handleMove(0, 1)} className="w-14 h-14 bg-gray-700 border-b-4 border-gray-900 rounded flex items-center justify-center text-2xl active:bg-gray-600">‚¨áÔ∏è</button>
                            <button onTouchStart={() => handleMove(1, 0)} onClick={() => handleMove(1, 0)} className="w-14 h-14 bg-gray-700 border-b-4 border-gray-900 rounded flex items-center justify-center text-2xl active:bg-gray-600">‚û°Ô∏è</button>
                        </div>
                        <div className="text-[10px] text-gray-400 mt-2">Use Arrow Keys or Buttons</div>
                    </div>
                );
            }

            if (gameState === 'playing') {
                const currentTask = levelTasks[activeTaskIndex];
                
                return (
                    <div className={`min-h-screen flex flex-col items-center py-4 px-4 max-w-6xl mx-auto ${shake ? 'animate-shake' : ''}`}>
                         {/* Header */}
                         <div className="w-full flex justify-between items-center mb-6 bg-gray-800 p-3 border-4 border-white rounded shadow-lg">
                            <div className="flex items-center gap-4">
                                <div className={`w-12 h-12 flex items-center justify-center text-2xl ${character.color} border-2 border-white rounded`}>{character.icon}</div>
                                <div className="flex flex-col text-left"><span className="text-[10px] text-gray-400">HERO</span><span className="text-xs text-white">{character.name}</span></div>
                            </div>
                            <div className="flex flex-col text-right"><span className="text-[10px] text-yellow-400">GOLD</span><span className="text-xl text-yellow-300">{gold}</span></div>
                        </div>

                        <div className="flex flex-col md:flex-row gap-6 w-full items-start h-full">
                            <div className="flex-1 w-full bg-slate-700 border-4 border-white rounded shadow-xl relative overflow-hidden">
                                <div className="absolute top-2 right-2 flex gap-1"><span className="text-red-500 text-lg">{attempts === 0 ? '‚ù§Ô∏è‚ù§Ô∏è' : attempts === 1 ? '‚ù§Ô∏èüñ§' : 'üñ§üñ§'}</span></div>
                                <div className={`p-6 border-b-4 border-slate-600 ${currentLevelData.bg} text-center min-h-[120px] flex items-center justify-center`}>
                                    <h2 className="text-xs md:text-sm leading-relaxed text-white">{currentTask.text}</h2>
                                </div>

                                <div className="p-8 flex flex-col items-center justify-center min-h-[220px] bg-slate-600 relative">
                                    {currentTask.visualType === 'coins' && <div className="flex flex-wrap justify-center gap-4">{currentTask.coins.map((c, i) => <Coin key={i} type={c} />)}</div>}
                                    {currentTask.visualType === 'subtraction' && (<div className="flex items-center text-xl md:text-3xl font-bold text-white gap-4"><div className="bg-slate-800 px-4 py-2 border-2 border-gray-400 rounded">{currentTask.start}</div><div className="text-red-400">-</div><div className="bg-slate-800 px-4 py-2 border-2 border-gray-400 rounded">{currentTask.minus}</div></div>)}
                                    {currentTask.visualType === 'items' && <div className="flex gap-4 md:gap-8 text-3xl md:text-4xl">{currentTask.items.map((item, i) => <div key={i} className="flex flex-col items-center"><span>{item.split(' ')[0]}</span><span className="text-[10px] bg-black text-white px-2 rounded mt-2 border border-gray-500">{item.split(' ')[1]}</span></div>)}</div>}
                                    {currentTask.visualType === 'simple' && <div className="text-6xl animate-bounce">{currentTask.image}</div>}
                                    {currentTask.visualType === 'text-only' && <div className="text-6xl text-gray-400">?</div>}
                                    
                                    {attempts === 1 && <div className="absolute bottom-2 left-0 right-0 text-center bg-yellow-900 text-yellow-100 py-1 text-[10px] border-t-2 border-yellow-600 animate-pulse">HINT: {currentTask.hint}</div>}
                                </div>

                                <div className="p-4 bg-slate-800 grid grid-cols-1 md:grid-cols-3 gap-4">
                                    {currentTask.options.map((opt, i) => (
                                        <button key={i} onClick={() => !disabledOptions.includes(opt) && handleAnswer(opt)} className={`py-4 border-b-4 rounded text-xs md:text-sm pixel-btn transition-colors ${disabledOptions.includes(opt) ? 'bg-gray-600 text-gray-400 border-gray-800' : 'bg-blue-600 text-white border-blue-800 hover:bg-blue-500'}`} disabled={disabledOptions.includes(opt)}>
                                            {opt}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className="w-full md:w-64 flex-shrink-0"><CoinWorkspace /></div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'levelOutro') {
                 return (
                     <div className={`flex flex-col items-center justify-center min-h-screen p-4 text-center bg-black`}>
                        <h1 className="text-4xl text-green-400 mb-4">LEVEL COMPLETE!</h1>
                        <p className="text-white mb-8">You found all the tasks!</p>
                        <button onClick={advanceLevel} className="bg-blue-600 text-white border-4 border-white px-8 py-4 pixel-btn text-sm uppercase">NEXT LEVEL ‚û°</button>
                    </div>
                );
            }

            if (gameState === 'end') {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen p-4 text-center">
                        <h1 className="text-5xl mb-6">üèÜ QUEST COMPLETE</h1>
                        <div className="bg-gray-800 p-8 border-4 border-white mb-8 rounded">
                            <p className="text-yellow-400 text-2xl mb-2">TOTAL GOLD</p>
                            <p className="text-white text-4xl">{gold}</p>
                        </div>
                        <button onClick={() => setGameState('start')} className="bg-green-600 text-white border-4 border-white px-8 py-4 pixel-btn">PLAY AGAIN</button>
                    </div>
                );
            }
            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MoneyMadness />);
    </script>
</body>
</html>
